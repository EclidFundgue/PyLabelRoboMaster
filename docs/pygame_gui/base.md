

# Base

`Base` 类是 `pygame_gui` 模块的核心元素之一，这个类

1. 是所有自定义 GUI 元素的直接或间接父类
2. 保存 GUI 元素的相对位置和大小
3. 提供鼠标、键盘响应接口
4. 提供了增加、删除子元素的接口
5. 规范了 GUI 元素的更新、渲染、生存周期管理方式



## 术语

- ***GUI 元素***：`Base` 子类的实例对象
- ***控制范围***：每个 GUI 元素都保存自己的宽（w）、高（h）、横坐标（x）、纵坐标（y）信息， 由这一组信息构成的矩形 `Rect(w,h,x,y)` 就是该 GUI 元素的控制范围。控制范围框定了 GUI 元素的渲染范围和交互范围。
- ***子元素***：GUI 元素的孩子元素



## 代码规范

### import 规范

import 部分分为 3 块，分别是

1. Python 内置库
2. Python 第三方库
3. 自定义模块

两块之间使用单行空格隔开，块内按照字母排序。

建议使用 `isort` 进行自动整理。



### 方法声明顺序

由于其中涉及的函数较多，将 `Base` 中所有的方法按照不同的功能分成几个大模块，模块应按照以下顺序排序：

1. **特殊方法（Special Methods）**：统一声明 Python 的特殊方法，如 `__init__`，`__repr__` 等
2. **自定义方法（Custom Methods）**：如果子类需要扩展新的方法，将方法定义在这里
3. **鼠标事件响应（Mouse Events）**
4. **键盘事件响应（Keyboard Events）**
5. **子元素管理（Child Management）**
6. **更新（Update）**
7. **渲染（Draw）**
8. **生存周期管理（Kill）**



在保证模块按照顺序排序以后，模块中的方法可以按照字母排序，也可以按照方法含义排序。在  `Base` 类中，模块内的方法是按照方法含义排序的。



### type hint 规范

所有自定义的函数和方法应当具有完整的 type hint，即函数的每一个变量和返回值都要给出类型提示。（除了 `__init__` 可以不提示返回 `None`）

有默认值的变量可以**不使用** `Optional` 标识。



### 换行规范

import 部分和功能性代码部分之间有 2 行间隔，其余代码之间至多只能有 1 行间隔。



## 模块设计说明

### 1.特殊方法

#### 变量

------

**`w`**

- **类型**：`int`
- **说明**：元素宽度

------

**`h`**

- **类型**：`int`
- **说明**：元素高度

------

**`x`**

- **类型**：`int`
- **说明**：元素相在其父元素上的 X 坐标

------

**`y`**

- **类型**：`int`
- **说明**：元素相在其父元素上的 Y 坐标

------



#### 方法

------

**`__init__(w,h,x,y)`**

- **参数**：
  - `w: int`：元素宽度
  - `h: int`：元素高度
  - `x: int`：元素相在其父元素上的 X 坐标
  - `y: int`：元素相在其父元素上的 Y 坐标
  
- **返回值**：无

------

**`__repr__()`**

- **参数**：无

- **返回值**：

  `str`：对象类名、大小、位置

------



### 2.鼠标事件



### 3.键盘事件



### 4.子元素管理

 `Base` 类提供了 3 个方法来辅助管理子元素，在使用时，并不建议直接对 `_children` 和 `_parent` 变量进行操作，而是使用

- `addChild(child)`
- `removeChild(child)`
- `setChildren(children)`

来进行管理，保证对象之间的依赖是正确的。



#### 变量

------

**`_parent`**

- **类型**：`Base`
- **说明**：该 GUI 元素的父元素，只有当该元素被添加到其它 GUI 对象中时才会被设置，否则为 `None`

------

**`_children`**

- **类型**：`List[Base]`
- **说明**：该 GUI 元素的所有子元素

------



#### 方法

------

**`removeDeadChildren()`**

- **说明**：这个方法通常不被外部调用，供类的内部使用，移除生命周期结束的子对象

- **参数**：无

- **返回值**：无

------

**`addChild(child)`**

- **参数**：
  - `child: Base`：将这个 GUI 元素添加为子元素

- **返回值**：无

------

**`removeChild(child)`**

- **参数**：
  - `child: Base`：将这个 GUI 元素从子元素中移除

- **返回值**：无

------

**`setChildren(children)`**

- **参数**：
  - `children: List[Base]`：将子元素强制刷新为该列表

- **返回值**：无

------



### 5.更新



### 6.渲染

渲染部分提供了2 个接口：`draw`，`redraw`

画面渲染采取惰性的更新方式：只有一个元素调用 `redraw` 方法时，画面才会更新，并且仅更新 GUI 元素控制范围内的画面。 在实现上，`redraw` 会向上传递到 `Root`，然后向下递归，对需要重绘的对象使用 `draw` 方法，实现更新。不论使用了几次 `redraw`，一个 GUI 元素的 `draw` 方法每帧最多执行一次。



#### 变量

------

**`layer`**

- **类型**：`int`
- **说明**：默认为0，layer 高的元素会覆盖在低的元素上方（从下往上绘制）。只有一个 GUI 元素内的子元素才会按照 layer 绘制，子元素一定会覆盖在其父元素上方。

------

**`redraw_parent`**

- **类型**：`bool`
- **说明**：父对象是否也需要调用 `redraw`。举个例子：在绘制时，如果这个对象本身将  subsurface 填充，那么它的父对象即使没有重绘，也不会造成绘制上的问题。如果绘制时仅绘制文字，就需要将父对象重绘，否则之前绘制的字体会和这次绘制的字体发生重叠。

------



#### 方法

------

**`draw(surface)`**

- **说明**：你**不需要**手动调用这个函数，它的调用由 `pygame_gui` 框架内部来管理，你只需要在子类中重写这个函数即可。 `Base` 类没有提供该函数的具体实现，所以不需要使用 `super` 继承父类。`draw` 的功能是绘制 GUI 元素自身，**不需要**绘制子元素，程序会在外部递归调用子元素的 `draw` 方法

- **参数**：
  - `subsurface: Surface`：surface大小通常和该 GUI 元素的控制范围相同，表示控制范围在屏幕上的区域 。（注意：如果因为子对象超过父对象的范围，超出边界的部分会被裁剪掉，导致surface大小小于 GUI 元素的控制范围）
  
- **返回值**：无

------

**`redraw()`**

- **参数**：无

- **返回值**：无

------



### 7.生存周期